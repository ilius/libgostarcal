package hijri

import (
	"fmt"
	"sort"
	"testing"

	"github.com/ilius/is/v2"
	lib "github.com/ilius/libgostarcal"
)

func init() {
	// fmt.Printf("%#v\n", monthData.MonthLenByYm)
	fmt.Printf("endJd = %v\n", monthData.EndJd)
}

func testIsLeap(t *testing.T) {
	is := is.New(t).MsgSep(", ").Lax()
	testMap := map[int]bool{
		1410: false,
		1411: false,
		1412: true,
		1413: false,
		1414: false,
		1415: true,
		1416: false,
		1417: true,
		1418: false,
		1419: false,
		1420: true,
		1421: false,
		1422: false,
		1423: true,
		1424: false,
		1425: false,
		1426: true,
		1427: false,
		1428: true,
		1429: false,
		1430: false,
		1431: true,
		1432: false,
		1433: false,
		1434: true,
		1435: false,
		1436: true,
		1437: false,
		1438: false,
		1439: true,
		1440: false,
		1441: false,
		1442: true,
		1443: false,
		1444: false,
		1445: true,
		1446: false,
		1447: true,
		1448: false,
		1449: false,
	}
	for year, isLeap := range testMap {
		is.AddMsg("mismatch isLeap, year=%v", year).Equal(IsLeap(year), isLeap)
	}
}

func TestIsLeap(t *testing.T) {
	SetUseMonthData(false)
	testIsLeap(t)
	SetUseMonthData(true)
	testIsLeap(t)
}

func TestToJd_1(t *testing.T) {
	SetUseMonthData(false)
	is := is.New(t).MsgSep(", ").Lax()
	testMap := map[*lib.Date]int{
		lib.NewDate(1436, 1, 1):  2456957,
		lib.NewDate(1436, 2, 1):  2456987,
		lib.NewDate(1436, 3, 1):  2457016,
		lib.NewDate(1436, 4, 1):  2457046,
		lib.NewDate(1436, 5, 1):  2457075,
		lib.NewDate(1436, 6, 1):  2457105,
		lib.NewDate(1436, 7, 1):  2457134,
		lib.NewDate(1436, 8, 1):  2457164,
		lib.NewDate(1436, 9, 1):  2457193,
		lib.NewDate(1436, 10, 1): 2457223,
		lib.NewDate(1436, 11, 1): 2457252,
		lib.NewDate(1436, 12, 1): 2457282,
		lib.NewDate(1437, 1, 1):  2457312,
		lib.NewDate(1437, 2, 1):  2457342,
		lib.NewDate(1437, 3, 1):  2457371,
		lib.NewDate(1437, 4, 1):  2457401,
		lib.NewDate(1437, 5, 1):  2457430,
		lib.NewDate(1437, 6, 1):  2457460,
		lib.NewDate(1437, 7, 1):  2457489,
		lib.NewDate(1437, 8, 1):  2457519,
		lib.NewDate(1437, 9, 1):  2457548,
		lib.NewDate(1437, 10, 1): 2457578,
		lib.NewDate(1437, 11, 1): 2457607,
		lib.NewDate(1437, 12, 1): 2457637,
		lib.NewDate(1438, 1, 1):  2457666,
		lib.NewDate(1438, 2, 1):  2457696,
		lib.NewDate(1438, 3, 1):  2457725,
		lib.NewDate(1438, 4, 1):  2457755,
		lib.NewDate(1438, 5, 1):  2457784,
		lib.NewDate(1438, 6, 1):  2457814,
		lib.NewDate(1438, 7, 1):  2457843,
		lib.NewDate(1438, 8, 1):  2457873,
		lib.NewDate(1438, 9, 1):  2457902,
		lib.NewDate(1438, 10, 1): 2457932,
		lib.NewDate(1438, 11, 1): 2457961,
		lib.NewDate(1438, 12, 1): 2457991,
		lib.NewDate(1439, 1, 1):  2458020,
		lib.NewDate(1439, 2, 1):  2458050,
		lib.NewDate(1439, 3, 1):  2458079,
		lib.NewDate(1439, 4, 1):  2458109,
		lib.NewDate(1439, 5, 1):  2458138,
		lib.NewDate(1439, 6, 1):  2458168,
		lib.NewDate(1439, 7, 1):  2458197,
		lib.NewDate(1439, 8, 1):  2458227,
		lib.NewDate(1439, 9, 1):  2458256,
		lib.NewDate(1439, 10, 1): 2458286,
		lib.NewDate(1439, 11, 1): 2458315,
		lib.NewDate(1439, 12, 1): 2458345,
	}
	for date, jd := range testMap {
		is.AddMsg("mismatch jd, date=%v, jd=%v", date, jd).Equal(ToJd(date), jd)
	}
}

func TestToJd_2(t *testing.T) {
	SetUseMonthData(true)
	is := is.New(t).MsgSep(", ").Lax()
	testMap := map[*lib.Date]int{
		lib.NewDate(1426, 1, 1):  2453413,
		lib.NewDate(1426, 2, 1):  2453443,
		lib.NewDate(1426, 3, 1):  2453471,
		lib.NewDate(1426, 4, 1):  2453501,
		lib.NewDate(1426, 5, 1):  2453530,
		lib.NewDate(1426, 6, 1):  2453560,
		lib.NewDate(1426, 7, 1):  2453590,
		lib.NewDate(1426, 8, 1):  2453620,
		lib.NewDate(1426, 9, 1):  2453650,
		lib.NewDate(1426, 10, 1): 2453679,
		lib.NewDate(1426, 11, 1): 2453709,
		lib.NewDate(1426, 12, 1): 2453738,
		lib.NewDate(1427, 1, 1):  2453767,
		lib.NewDate(1427, 2, 1):  2453797,
		lib.NewDate(1427, 3, 1):  2453826,
		lib.NewDate(1427, 4, 1):  2453855,
		lib.NewDate(1427, 5, 1):  2453885,
		lib.NewDate(1427, 6, 1):  2453914,
		lib.NewDate(1427, 7, 1):  2453944,
		lib.NewDate(1427, 8, 1):  2453974,
		lib.NewDate(1427, 9, 1):  2454004,
		lib.NewDate(1427, 10, 1): 2454034,
		lib.NewDate(1427, 11, 1): 2454063,
		lib.NewDate(1427, 12, 1): 2454092,
		lib.NewDate(1428, 1, 1):  2454122,
		lib.NewDate(1428, 2, 1):  2454151,
		lib.NewDate(1428, 3, 1):  2454181,
		lib.NewDate(1428, 4, 1):  2454210,
		lib.NewDate(1428, 5, 1):  2454239,
		lib.NewDate(1428, 6, 1):  2454268,
		lib.NewDate(1428, 7, 1):  2454298,
		lib.NewDate(1428, 8, 1):  2454328,
		lib.NewDate(1428, 9, 1):  2454357,
		lib.NewDate(1428, 10, 1): 2454387,
		lib.NewDate(1428, 11, 1): 2454417,
		lib.NewDate(1428, 12, 1): 2454447,
		lib.NewDate(1429, 1, 1):  2454476,
		lib.NewDate(1429, 2, 1):  2454506,
		lib.NewDate(1429, 3, 1):  2454535,
		lib.NewDate(1429, 4, 1):  2454565,
		lib.NewDate(1429, 5, 1):  2454594,
		lib.NewDate(1429, 6, 1):  2454623,
		lib.NewDate(1429, 7, 1):  2454652,
		lib.NewDate(1429, 8, 1):  2454682,
		lib.NewDate(1429, 9, 1):  2454712,
		lib.NewDate(1429, 10, 1): 2454741,
		lib.NewDate(1429, 11, 1): 2454771,
		lib.NewDate(1429, 12, 1): 2454801,
		lib.NewDate(1430, 1, 1):  2454830,
		lib.NewDate(1430, 2, 1):  2454860,
		lib.NewDate(1430, 3, 1):  2454890,
		lib.NewDate(1430, 4, 1):  2454919,
		lib.NewDate(1430, 5, 1):  2454948,
		lib.NewDate(1430, 6, 1):  2454978,
		lib.NewDate(1430, 7, 1):  2455007,
		lib.NewDate(1430, 8, 1):  2455037,
		lib.NewDate(1430, 9, 1):  2455066,
		lib.NewDate(1430, 10, 1): 2455095,
		lib.NewDate(1430, 11, 1): 2455125,
		lib.NewDate(1430, 12, 1): 2455155,
		lib.NewDate(1431, 1, 1):  2455184,
		lib.NewDate(1431, 2, 1):  2455214,
		lib.NewDate(1431, 3, 1):  2455244,
		lib.NewDate(1431, 4, 1):  2455273,
		lib.NewDate(1431, 5, 1):  2455303,
		lib.NewDate(1431, 6, 1):  2455332,
		lib.NewDate(1431, 7, 1):  2455362,
		lib.NewDate(1431, 8, 1):  2455391,
		lib.NewDate(1431, 9, 1):  2455421,
		lib.NewDate(1431, 10, 1): 2455450,
		lib.NewDate(1431, 11, 1): 2455479,
		lib.NewDate(1431, 12, 1): 2455509,
		lib.NewDate(1432, 1, 1):  2455538,
		lib.NewDate(1432, 2, 1):  2455568,
		lib.NewDate(1432, 3, 1):  2455598,
		lib.NewDate(1432, 4, 1):  2455627,
		lib.NewDate(1432, 5, 1):  2455657,
		lib.NewDate(1432, 6, 1):  2455687,
		lib.NewDate(1432, 7, 1):  2455717,
		lib.NewDate(1432, 8, 1):  2455746,
		lib.NewDate(1432, 9, 1):  2455775,
		lib.NewDate(1432, 10, 1): 2455805,
		lib.NewDate(1432, 11, 1): 2455834,
		lib.NewDate(1432, 12, 1): 2455864,
		lib.NewDate(1433, 1, 1):  2455893,
		lib.NewDate(1433, 2, 1):  2455922,
		lib.NewDate(1433, 3, 1):  2455952,
		lib.NewDate(1433, 4, 1):  2455981,
		lib.NewDate(1433, 5, 1):  2456011,
		lib.NewDate(1433, 6, 1):  2456041,
		lib.NewDate(1433, 7, 1):  2456071,
		lib.NewDate(1433, 8, 1):  2456100,
		lib.NewDate(1433, 9, 1):  2456130,
		lib.NewDate(1433, 10, 1): 2456159,
		lib.NewDate(1433, 11, 1): 2456189,
		lib.NewDate(1433, 12, 1): 2456218,
		lib.NewDate(1434, 1, 1):  2456248,
		lib.NewDate(1434, 2, 1):  2456277,
		lib.NewDate(1434, 3, 1):  2456306,
		lib.NewDate(1434, 4, 1):  2456336,
		lib.NewDate(1434, 5, 1):  2456365,
		lib.NewDate(1434, 6, 1):  2456395,
		lib.NewDate(1434, 7, 1):  2456425,
		lib.NewDate(1434, 8, 1):  2456454,
		lib.NewDate(1434, 9, 1):  2456484,
		lib.NewDate(1434, 10, 1): 2456514,
		lib.NewDate(1434, 11, 1): 2456543,
		lib.NewDate(1434, 12, 1): 2456573,
		lib.NewDate(1435, 1, 1):  2456602,
		lib.NewDate(1435, 2, 1):  2456631,
		lib.NewDate(1435, 3, 1):  2456661,
		lib.NewDate(1435, 4, 1):  2456690,
		lib.NewDate(1435, 5, 1):  2456720,
		lib.NewDate(1435, 6, 1):  2456749,
		lib.NewDate(1435, 7, 1):  2456779,
		lib.NewDate(1435, 8, 1):  2456808,
		lib.NewDate(1435, 9, 1):  2456838,
		lib.NewDate(1435, 10, 1): 2456868,
		lib.NewDate(1435, 11, 1): 2456898,
		lib.NewDate(1435, 12, 1): 2456927,
		lib.NewDate(1436, 1, 1):  2456957,
		lib.NewDate(1436, 2, 1):  2456986,
		lib.NewDate(1436, 3, 1):  2457016,
		lib.NewDate(1436, 4, 1):  2457045,
		lib.NewDate(1436, 5, 1):  2457074,
		lib.NewDate(1436, 6, 1):  2457104,
		lib.NewDate(1436, 7, 1):  2457133,
		lib.NewDate(1436, 8, 1):  2457163,
		lib.NewDate(1436, 9, 1):  2457192,
		lib.NewDate(1436, 10, 1): 2457222,
		lib.NewDate(1436, 11, 1): 2457251,
		lib.NewDate(1436, 12, 1): 2457281,
		lib.NewDate(1437, 1, 1):  2457311,
		lib.NewDate(1437, 2, 1):  2457340,
		lib.NewDate(1437, 3, 1):  2457370,
		lib.NewDate(1437, 4, 1):  2457400,
		lib.NewDate(1437, 5, 1):  2457429,
		lib.NewDate(1437, 6, 1):  2457459,
		lib.NewDate(1437, 7, 1):  2457488,
		lib.NewDate(1437, 8, 1):  2457517,
		lib.NewDate(1437, 9, 1):  2457547,
		lib.NewDate(1437, 10, 1): 2457576,
		lib.NewDate(1437, 11, 1): 2457605,
		lib.NewDate(1437, 12, 1): 2457635,
		lib.NewDate(1438, 1, 1):  2457665,
		lib.NewDate(1438, 2, 1):  2457694,
		lib.NewDate(1438, 3, 1):  2457724,
		lib.NewDate(1438, 4, 1):  2457754,
		lib.NewDate(1438, 5, 1):  2457784,
		lib.NewDate(1438, 6, 1):  2457813,
		lib.NewDate(1438, 7, 1):  2457843,
		lib.NewDate(1438, 8, 1):  2457872,
		lib.NewDate(1438, 9, 1):  2457901,
		lib.NewDate(1438, 10, 1): 2457931,
		lib.NewDate(1438, 11, 1): 2457960,
		lib.NewDate(1438, 12, 1): 2457989,
		lib.NewDate(1439, 1, 1):  2458019,
		lib.NewDate(1439, 2, 1):  2458048,
		lib.NewDate(1439, 3, 1):  2458078,
		lib.NewDate(1439, 4, 1):  2458108,
		lib.NewDate(1439, 5, 1):  2458138,
		lib.NewDate(1439, 6, 1):  2458168,
		lib.NewDate(1439, 7, 1):  2458197,
		lib.NewDate(1439, 8, 1):  2458227,
		lib.NewDate(1439, 9, 1):  2458256,
		lib.NewDate(1439, 10, 1): 2458285,
		lib.NewDate(1439, 11, 1): 2458315,
		lib.NewDate(1439, 12, 1): 2458344,
		lib.NewDate(1440, 1, 1):  2458373,
		lib.NewDate(1440, 2, 1):  2458403,
		lib.NewDate(1440, 3, 1):  2458432,
		lib.NewDate(1440, 4, 1):  2458462,
		lib.NewDate(1440, 5, 1):  2458492,
		lib.NewDate(1440, 6, 1):  2458522,
		lib.NewDate(1440, 7, 1):  2458551,
		lib.NewDate(1440, 8, 1):  2458581,
		lib.NewDate(1440, 9, 1):  2458611,
		lib.NewDate(1440, 10, 1): 2458640,
		lib.NewDate(1440, 11, 1): 2458669,
		lib.NewDate(1440, 12, 1): 2458699,
		lib.NewDate(1441, 1, 1):  2458728,
		lib.NewDate(1441, 2, 1):  2458757,
		lib.NewDate(1441, 3, 1):  2458787,
		lib.NewDate(1441, 4, 1):  2458816,
		lib.NewDate(1441, 5, 1):  2458846,
		lib.NewDate(1441, 6, 1):  2458876,
		lib.NewDate(1441, 7, 1):  2458905,
		lib.NewDate(1441, 8, 1):  2458935,
		lib.NewDate(1441, 9, 1):  2458965,
		lib.NewDate(1441, 10, 1): 2458994,
		lib.NewDate(1441, 11, 1): 2459024,
		lib.NewDate(1441, 12, 1): 2459053,
		lib.NewDate(1442, 1, 1):  2459083,
		lib.NewDate(1442, 2, 1):  2459112,
		lib.NewDate(1442, 3, 1):  2459141,
		lib.NewDate(1442, 4, 1):  2459171,
		lib.NewDate(1442, 5, 1):  2459200,
		lib.NewDate(1442, 6, 1):  2459230,
		lib.NewDate(1442, 7, 1):  2459259,
		lib.NewDate(1442, 8, 1):  2459289,
		lib.NewDate(1442, 9, 1):  2459319,
		lib.NewDate(1442, 10, 1): 2459348,
		lib.NewDate(1442, 11, 1): 2459378,
		lib.NewDate(1442, 12, 1): 2459408,
		lib.NewDate(1443, 1, 1):  2459437,
		lib.NewDate(1443, 2, 1):  2459466,
		lib.NewDate(1443, 3, 1):  2459496,
		lib.NewDate(1443, 4, 1):  2459526,
		lib.NewDate(1443, 5, 1):  2459555,
		lib.NewDate(1443, 6, 1):  2459584,
		lib.NewDate(1443, 7, 1):  2459614,
		lib.NewDate(1443, 8, 1):  2459643,
		lib.NewDate(1443, 9, 1):  2459673,
		lib.NewDate(1443, 10, 1): 2459704,
		lib.NewDate(1443, 11, 1): 2459733,
		lib.NewDate(1443, 12, 1): 2459763,
	}
	testList := make([][]interface{}, 0, len(testMap))
	for key, value := range testMap {
		testList = append(testList, []interface{}{key, value})
	}
	sort.Slice(testList, func(i, j int) bool {
		return testList[i][1].(int) < testList[j][1].(int)
	})
	for _, item := range testList {
		date := item[0].(*lib.Date)
		expectedJd := item[1].(int)
		actualJd := ToJd(date)
		is.AddMsg(
			"mismatch jd, date=%v, jd_diff=%v",
			date,
			actualJd-expectedJd,
		).Equal(actualJd, expectedJd)
	}
}

func TestJdTo_2(t *testing.T) {
	SetUseMonthData(true)
	is := is.New(t).MsgSep(", ").Lax()
	testMap := map[int]*lib.Date{
		2453442: lib.NewDate(1426, 2, 1),
		2453469: lib.NewDate(1426, 2, 28),
		2453496: lib.NewDate(1426, 3, 26),
		2453523: lib.NewDate(1426, 4, 23),
		2453550: lib.NewDate(1426, 5, 21),
		2453577: lib.NewDate(1426, 6, 18),
		2453604: lib.NewDate(1426, 7, 15),
		2453631: lib.NewDate(1426, 8, 12),
		2453658: lib.NewDate(1426, 9, 9),
		2453685: lib.NewDate(1426, 10, 7),
		2453712: lib.NewDate(1426, 11, 4),
		2453739: lib.NewDate(1426, 12, 2),
		2453766: lib.NewDate(1426, 12, 29),
		2453793: lib.NewDate(1427, 1, 27),
		2453820: lib.NewDate(1427, 2, 24),
		2453847: lib.NewDate(1427, 3, 22),
		2453874: lib.NewDate(1427, 4, 20),
		2453901: lib.NewDate(1427, 5, 17),
		2453928: lib.NewDate(1427, 6, 15),
		2453955: lib.NewDate(1427, 7, 12),
		2453982: lib.NewDate(1427, 8, 9),
		2454009: lib.NewDate(1427, 9, 6),
		2454036: lib.NewDate(1427, 10, 3),
		2454063: lib.NewDate(1427, 11, 1),
		2454090: lib.NewDate(1427, 11, 28),
		2454117: lib.NewDate(1427, 12, 26),
		2454144: lib.NewDate(1428, 1, 23),
		2454171: lib.NewDate(1428, 2, 21),
		2454198: lib.NewDate(1428, 3, 18),
		2454225: lib.NewDate(1428, 4, 16),
		2454252: lib.NewDate(1428, 5, 14),
		2454279: lib.NewDate(1428, 6, 12),
		2454306: lib.NewDate(1428, 7, 9),
		2454333: lib.NewDate(1428, 8, 6),
		2454360: lib.NewDate(1428, 9, 4),
		2454387: lib.NewDate(1428, 10, 1),
		2454414: lib.NewDate(1428, 10, 28),
		2454441: lib.NewDate(1428, 11, 25),
		2454468: lib.NewDate(1428, 12, 22),
		2454495: lib.NewDate(1429, 1, 20),
		2454522: lib.NewDate(1429, 2, 17),
		2454549: lib.NewDate(1429, 3, 15),
		2454576: lib.NewDate(1429, 4, 12),
		2454603: lib.NewDate(1429, 5, 10),
		2454630: lib.NewDate(1429, 6, 8),
		2454657: lib.NewDate(1429, 7, 6),
		2454684: lib.NewDate(1429, 8, 3),
		2454711: lib.NewDate(1429, 8, 30),
		2454738: lib.NewDate(1429, 9, 27),
		2454765: lib.NewDate(1429, 10, 25),
		2454792: lib.NewDate(1429, 11, 22),
		2454819: lib.NewDate(1429, 12, 19),
		2454846: lib.NewDate(1430, 1, 17),
		2454873: lib.NewDate(1430, 2, 14),
		2454900: lib.NewDate(1430, 3, 11),
		2454927: lib.NewDate(1430, 4, 9),
		2454954: lib.NewDate(1430, 5, 7),
		2454981: lib.NewDate(1430, 6, 4),
		2455008: lib.NewDate(1430, 7, 2),
		2455035: lib.NewDate(1430, 7, 29),
		2455062: lib.NewDate(1430, 8, 26),
		2455089: lib.NewDate(1430, 9, 24),
		2455116: lib.NewDate(1430, 10, 22),
		2455143: lib.NewDate(1430, 11, 19),
		2455170: lib.NewDate(1430, 12, 16),
		2455197: lib.NewDate(1431, 1, 14),
		2455224: lib.NewDate(1431, 2, 11),
		2455251: lib.NewDate(1431, 3, 8),
		2455278: lib.NewDate(1431, 4, 6),
		2455305: lib.NewDate(1431, 5, 3),
		2455332: lib.NewDate(1431, 6, 1),
		2455359: lib.NewDate(1431, 6, 28),
		2455386: lib.NewDate(1431, 7, 25),
		2455413: lib.NewDate(1431, 8, 23),
		2455440: lib.NewDate(1431, 9, 20),
		2455467: lib.NewDate(1431, 10, 18),
		2455494: lib.NewDate(1431, 11, 16),
		2455521: lib.NewDate(1431, 12, 13),
		2455548: lib.NewDate(1432, 1, 11),
		2455575: lib.NewDate(1432, 2, 8),
		2455602: lib.NewDate(1432, 3, 5),
		2455629: lib.NewDate(1432, 4, 3),
		2455656: lib.NewDate(1432, 4, 30),
		2455683: lib.NewDate(1432, 5, 27),
		2455710: lib.NewDate(1432, 6, 24),
		2455737: lib.NewDate(1432, 7, 21),
		2455764: lib.NewDate(1432, 8, 19),
		2455791: lib.NewDate(1432, 9, 17),
		2455818: lib.NewDate(1432, 10, 14),
		2455845: lib.NewDate(1432, 11, 12),
		2455872: lib.NewDate(1432, 12, 9),
		2455899: lib.NewDate(1433, 1, 7),
		2455926: lib.NewDate(1433, 2, 5),
		2455953: lib.NewDate(1433, 3, 2),
		2455980: lib.NewDate(1433, 3, 29),
		2456007: lib.NewDate(1433, 4, 27),
		2456034: lib.NewDate(1433, 5, 24),
		2456061: lib.NewDate(1433, 6, 21),
		2456088: lib.NewDate(1433, 7, 18),
		2456115: lib.NewDate(1433, 8, 16),
		2456142: lib.NewDate(1433, 9, 13),
		2456169: lib.NewDate(1433, 10, 11),
		2456196: lib.NewDate(1433, 11, 8),
		2456223: lib.NewDate(1433, 12, 6),
		2456250: lib.NewDate(1434, 1, 3),
		2456277: lib.NewDate(1434, 2, 1),
		2456304: lib.NewDate(1434, 2, 28),
		2456331: lib.NewDate(1434, 3, 26),
		2456358: lib.NewDate(1434, 4, 23),
		2456385: lib.NewDate(1434, 5, 21),
		2456412: lib.NewDate(1434, 6, 18),
		2456439: lib.NewDate(1434, 7, 15),
		2456466: lib.NewDate(1434, 8, 13),
		2456493: lib.NewDate(1434, 9, 10),
		2456520: lib.NewDate(1434, 10, 7),
		2456547: lib.NewDate(1434, 11, 5),
		2456574: lib.NewDate(1434, 12, 2),
		2456601: lib.NewDate(1434, 12, 29),
		2456628: lib.NewDate(1435, 1, 27),
		2456655: lib.NewDate(1435, 2, 25),
		2456682: lib.NewDate(1435, 3, 22),
		2456709: lib.NewDate(1435, 4, 20),
		2456736: lib.NewDate(1435, 5, 17),
		2456763: lib.NewDate(1435, 6, 15),
		2456790: lib.NewDate(1435, 7, 12),
		2456817: lib.NewDate(1435, 8, 10),
		2456844: lib.NewDate(1435, 9, 7),
		2456871: lib.NewDate(1435, 10, 4),
		2456898: lib.NewDate(1435, 11, 1),
		2456925: lib.NewDate(1435, 11, 28),
		2456952: lib.NewDate(1435, 12, 26),
		2456979: lib.NewDate(1436, 1, 23),
		2457006: lib.NewDate(1436, 2, 21),
		2457033: lib.NewDate(1436, 3, 18),
		2457060: lib.NewDate(1436, 4, 16),
		2457087: lib.NewDate(1436, 5, 14),
		2457114: lib.NewDate(1436, 6, 11),
		2457141: lib.NewDate(1436, 7, 9),
		2457168: lib.NewDate(1436, 8, 6),
		2457195: lib.NewDate(1436, 9, 4),
		2457222: lib.NewDate(1436, 10, 1),
		2457249: lib.NewDate(1436, 10, 28),
		2457276: lib.NewDate(1436, 11, 26),
		2457303: lib.NewDate(1436, 12, 23),
		2457330: lib.NewDate(1437, 1, 20),
		2457357: lib.NewDate(1437, 2, 18),
		2457384: lib.NewDate(1437, 3, 15),
		2457411: lib.NewDate(1437, 4, 12),
		2457438: lib.NewDate(1437, 5, 10),
		2457465: lib.NewDate(1437, 6, 7),
		2457492: lib.NewDate(1437, 7, 5),
		2457519: lib.NewDate(1437, 8, 3),
		2457546: lib.NewDate(1437, 8, 30),
		2457573: lib.NewDate(1437, 9, 27),
		2457600: lib.NewDate(1437, 10, 25),
		2457627: lib.NewDate(1437, 11, 23),
		2457654: lib.NewDate(1437, 12, 20),
		2457681: lib.NewDate(1438, 1, 17),
		2457708: lib.NewDate(1438, 2, 15),
		2457735: lib.NewDate(1438, 3, 12),
		2457762: lib.NewDate(1438, 4, 9),
		2457789: lib.NewDate(1438, 5, 6),
		2457816: lib.NewDate(1438, 6, 4),
		2457843: lib.NewDate(1438, 7, 1),
		2457870: lib.NewDate(1438, 7, 28),
		2457897: lib.NewDate(1438, 8, 26),
		2457924: lib.NewDate(1438, 9, 24),
		2457951: lib.NewDate(1438, 10, 21),
		2457978: lib.NewDate(1438, 11, 19),
		2458005: lib.NewDate(1438, 12, 17),
		2458032: lib.NewDate(1439, 1, 14),
		2458059: lib.NewDate(1439, 2, 12),
		2458086: lib.NewDate(1439, 3, 9),
		2458113: lib.NewDate(1439, 4, 6),
		2458140: lib.NewDate(1439, 5, 3),
		2458167: lib.NewDate(1439, 5, 30),
		2458194: lib.NewDate(1439, 6, 27),
		2458221: lib.NewDate(1439, 7, 25),
		2458248: lib.NewDate(1439, 8, 22),
		2458275: lib.NewDate(1439, 9, 20),
		2458302: lib.NewDate(1439, 10, 18),
		2458329: lib.NewDate(1439, 11, 15),
		2458356: lib.NewDate(1439, 12, 13),
		2458383: lib.NewDate(1440, 1, 11),
		2458410: lib.NewDate(1440, 2, 8),
		2458437: lib.NewDate(1440, 3, 6),
		2458464: lib.NewDate(1440, 4, 3),
		2458491: lib.NewDate(1440, 4, 30),
		2458518: lib.NewDate(1440, 5, 27),
		2458545: lib.NewDate(1440, 6, 24),
		2458572: lib.NewDate(1440, 7, 22),
		2458599: lib.NewDate(1440, 8, 19),
		2458626: lib.NewDate(1440, 9, 16),
		2458653: lib.NewDate(1440, 10, 14),
		2458680: lib.NewDate(1440, 11, 12),
		2458707: lib.NewDate(1440, 12, 9),
		2458734: lib.NewDate(1441, 1, 7),
		2458761: lib.NewDate(1441, 2, 5),
		2458788: lib.NewDate(1441, 3, 2),
		2458815: lib.NewDate(1441, 3, 29),
		2458842: lib.NewDate(1441, 4, 27),
		2458869: lib.NewDate(1441, 5, 24),
		2458896: lib.NewDate(1441, 6, 21),
		2458923: lib.NewDate(1441, 7, 19),
		2458950: lib.NewDate(1441, 8, 16),
		2458977: lib.NewDate(1441, 9, 13),
		2459004: lib.NewDate(1441, 10, 11),
		2459031: lib.NewDate(1441, 11, 8),
		2459058: lib.NewDate(1441, 12, 6),
		2459085: lib.NewDate(1442, 1, 3),
		2459112: lib.NewDate(1442, 2, 1),
		2459139: lib.NewDate(1442, 2, 28),
		2459166: lib.NewDate(1442, 3, 26),
		2459193: lib.NewDate(1442, 4, 23),
		2459220: lib.NewDate(1442, 5, 21),
		2459247: lib.NewDate(1442, 6, 18),
		2459274: lib.NewDate(1442, 7, 16),
		2459301: lib.NewDate(1442, 8, 13),
		2459328: lib.NewDate(1442, 9, 10),
		2459355: lib.NewDate(1442, 10, 8),
		2459382: lib.NewDate(1442, 11, 5),
		2459409: lib.NewDate(1442, 12, 2),
		2459436: lib.NewDate(1442, 12, 29),
		2459463: lib.NewDate(1443, 1, 27),
		2459490: lib.NewDate(1443, 2, 25),
		2459517: lib.NewDate(1443, 3, 22),
		2459544: lib.NewDate(1443, 4, 19),
		2459571: lib.NewDate(1443, 5, 17),
		2459598: lib.NewDate(1443, 6, 15),
		2459625: lib.NewDate(1443, 7, 12),
		2459652: lib.NewDate(1443, 8, 10),
	}
	testList := make([][]interface{}, 0, len(testMap))
	for key, value := range testMap {
		testList = append(testList, []interface{}{key, value})
	}
	sort.Slice(testList, func(i, j int) bool {
		return testList[i][0].(int) < testList[j][0].(int)
	})
	for _, item := range testList {
		jd := item[0].(int)
		expectedDate := item[1].(*lib.Date)
		actualDate := JdTo(jd)
		is.AddMsg(
			"mismatch date, jd=%v",
			jd,
		).Equal(actualDate, expectedDate)
	}
}

func TestMonthLen_1(t *testing.T) {
	SetUseMonthData(false)
	is := is.New(t).MsgSep(", ").Lax()
	testMap := map[[2]int]uint8{
		{1436, 1}:  30,
		{1436, 2}:  29,
		{1436, 3}:  30,
		{1436, 4}:  29,
		{1436, 5}:  30,
		{1436, 6}:  29,
		{1436, 7}:  30,
		{1436, 8}:  29,
		{1436, 9}:  30,
		{1436, 10}: 29,
		{1436, 11}: 30,
		{1436, 12}: 30,
		{1437, 1}:  30,
		{1437, 2}:  29,
		{1437, 3}:  30,
		{1437, 4}:  29,
		{1437, 5}:  30,
		{1437, 6}:  29,
		{1437, 7}:  30,
		{1437, 8}:  29,
		{1437, 9}:  30,
		{1437, 10}: 29,
		{1437, 11}: 30,
		{1437, 12}: 29,
		{1438, 1}:  30,
		{1438, 2}:  29,
		{1438, 3}:  30,
		{1438, 4}:  29,
		{1438, 5}:  30,
		{1438, 6}:  29,
		{1438, 7}:  30,
		{1438, 8}:  29,
		{1438, 9}:  30,
		{1438, 10}: 29,
		{1438, 11}: 30,
		{1438, 12}: 29,
		{1439, 1}:  30,
		{1439, 2}:  29,
		{1439, 3}:  30,
		{1439, 4}:  29,
		{1439, 5}:  30,
		{1439, 6}:  29,
		{1439, 7}:  30,
		{1439, 8}:  29,
		{1439, 9}:  30,
		{1439, 10}: 29,
		{1439, 11}: 30,
		{1439, 12}: 30,
	}
	for ym, mLen := range testMap {
		is.AddMsg("mismatch month length, ym=%v", ym).Equal(
			GetMonthLen(ym[0], uint8(ym[1])),
			mLen,
		)
	}
}

func TestConvert_1(t *testing.T) {
	SetUseMonthData(false)
	is := is.New(t).MsgSep(", ").Lax()
	startYear := 1390
	endYear := 1480
	for year := startYear; year < endYear; year++ {
		for month := uint8(1); month <= 12; month++ {
			monthLen := GetMonthLen(year, month)
			for day := uint8(1); day <= monthLen; day++ {
				date := lib.NewDate(year, month, day)
				jd := ToJd(date)
				ndate := JdTo(jd)
				is.AddMsg("jd=%v, date=%v, ndate=%v", jd, date, ndate).Equal(ndate, date)
			}
		}
	}
}
